<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CMS Ecommerce App</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="styles.css">
  <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-router-dom@6/umd/react-router-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>

<body>
  <header class="bg-primary text-white p-3 mb-4 sticky-top">
    <div class="container d-flex justify-content-between align-items-center">
      <h1 class="h3 mb-0"><i class="fas fa-store me-2"></i>Ecommerce Demo</h1>
      <nav>
        <a href="/" class="text-white me-3">Home</a>
        <a href="/products" class="text-white me-3">Products</a>
        <a href="/cart" class="text-white me-3">Cart</a>
        <a href="/about" class="text-white me-3">About</a>
        <a href="/contact" class="text-white">Contact</a>
      </nav>
      <button class="btn btn-light dark-mode-toggle" aria-label="Toggle dark mode">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <div id="root" class="container"></div>

  <footer class="text-white text-center mt-5 mb-3">
    &copy; 2025 My Shop
  </footer>

  <script type="text/babel">
    const { BrowserRouter, Routes, Route, Link, useNavigate, useParams } = ReactRouterDOM;
    const currency = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });

    // Example simple component for the chatbot
    function Chatbot() {
      const [messages, setMessages] = React.useState([]);
      const [message, setMessage] = React.useState('');
      const [loading, setLoading] = React.useState(false);

      React.useEffect(() => {
        fetch('/chat/history')
          .then(res => res.json())
          .then(hist => setMessages(hist || []));
      }, []);

      const sendMessage = () => {
        if (!message.trim()) return;
        const userMsg = { from: 'user', text: message.trim() };
        setMessages(prev => [...prev, userMsg]);
        setMessage('');
        setLoading(true);
        fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: userMsg.text })
        })
          .then(res => res.json())
          .then(data => {
            if (data && data.response) {
              setMessages(prev => [...prev, { from: 'bot', text: data.response }]);
            }
          })
          .finally(() => setLoading(false));
      };

      return (
        <div className="mt-5" aria-label="Chatbot assistant">
          <h3>Chatbot Assistant</h3>
          <div style={{ maxHeight: '200px', overflowY: 'auto' }}>
            {messages.map((m, i) => (
              <div key={i} className="mb-1">
                <strong>{m.from === 'bot' ? 'Bot' : 'You'}:</strong> {m.text}
              </div>
            ))}
            {loading && <div className="text-muted">Bot is typing...</div>}
          </div>
          <div className="input-group mt-2">
            <input
              className="form-control"
              placeholder="Type a message"
              value={message}
              onChange={e => setMessage(e.target.value)}
              onKeyDown={e => { if (e.key === 'Enter') sendMessage(); }}
            />
            <button className="btn btn-secondary" onClick={sendMessage} disabled={!message.trim() || loading}>
              Send
            </button>
          </div>
        </div>
      );
    }

    // Example home page
    function HomePage() {
      return (
        <div>
          <h2>Welcome to our demo store</h2>
          <p>Browse products, add your own, and chat with our assistant.</p>
          <Chatbot />
        </div>
      );
    }

    function NotFound() {
      return <h2>404 - Page Not Found</h2>;
    }

    function App() {
      return (
        <BrowserRouter>
          <Routes>
            <Route path="/" element={<HomePage />} />
            <Route path="*" element={<NotFound />} />
          </Routes>
        </BrowserRouter>
      );
    }

    // Dark mode toggle
    React.useEffect(() => {
      document.querySelector('.dark-mode-toggle').addEventListener('click', () => {
        document.body.classList.toggle('dark');
      });
    }, []);

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
